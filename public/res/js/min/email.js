$(document).ready(function(){CreateAndInitializeEmailForm()});
function CreateAndInitializeEmailForm(){$(".import-contacts").click(function(){TribZi.rpc.showAddressBook()});$("#message").val(TribZi.deal.landing.customMessage);$("#contact").submit(function(){return!1});$("#message").keyup(function(){TribZi.setCustomMessage($("#message").val())});$("#emailSubmit").click(function(){var a=$("#mail-input").val(),b=$("#message").val().length,a=validateEmail(a);!1==a?$("#mail-input").addClass("error"):!0==a&&$("#mail-input").removeClass("error");4>b?$("#message").addClass("error"):
4<=b&&$("#message").removeClass("error");!0==a&&4<=b&&(TribZi.clearTargets().setUid(null).addTarget(TribZi.deal.order.customer.email,$("#mail-input").val(),"friend","email").setCustomMessage($("#message").val()).setRewardIndex($("#slider").slider("value")),0==TribZi.sharedTimes&&TribZi.addTarget(TribZi.deal.order.branch.email,TribZi.deal.order.customer.email,"leader","email"),TribZi.share(null),showSuccess("Your message has been sent! Your coupon for next purchase is on the way! Keep on sharing"),
switchToTwitter())})}function switchToTwitter(){setTimeout(function(){$("#emailShare").click();$("#twitterShare").click();$("#tbox").find("iframe").contents().find("#tweet-box").focus()},500)}
function validateEmail(a){a=a.split(",");if(0==a.length)return!1;for(i=0;i<a.length;i++){var b=a[i].trim();if(0==b.length)break;if(!/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(b))return!1}return!0};